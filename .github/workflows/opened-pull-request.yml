name: Pull Request Opened - Check labels and generate version

on:
  pull_request:
    types: [opened, labeled, unlabeled, synchronize]

concurrency:
  group: ${{ github.ref }}-${{ github.workflow }}
  cancel-in-progress: true

jobs:
  check-label:
    name: Check Pull Request Label
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: read
    steps:
      - name: Require one of [MAJOR, MINOR, PATCH]
        uses: mheap/github-action-required-labels@v5
        with:
          mode: minimum
          count: 1
          labels: "MAJOR, MINOR, PATCH"

  generate-version:
    name: Generate Version
    needs: check-label
    permissions:
      contents: read
    uses: ./.github/workflows/generate-version.yml

  comment-on-pr:
    name: Comment on Pull Request
    needs: generate-version
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Add PR comment with version
        uses: mshick/add-pr-comment@v2
        with:
          message: "ðŸ“¦ New version generated by CI: `${{ needs.generate-version.outputs.version }}`"
